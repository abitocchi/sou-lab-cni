global
    maxconn 20000
    ulimit-n 16384
    log 127.0.0.1 local0
    daemon

frontend default
    mode http
    log global
    option httplog
    option dontlognull
    option nolinger
    maxconn 8000
    timeout client 30s
    bind *:8080
    #bind *:8443 ssl crt /usr/local/etc/haproxy/certs/foo.pem
    acl is_grafana hdr(host) -i grafana.lab.local
    use_backend grafana if is_grafana
    acl is_prometheus hdr(host) -i prometheus.lab.local
    use_backend prometheus if is_prometheus

backend grafana
    mode http
    balance roundrobin
    option httpchk
    server grafana1 192.168.0.2:3000 check

backend prometheus
    mode http
    balance roundrobin
    option httpchk
    server prometheus1 192.168.0.2:9090 check
